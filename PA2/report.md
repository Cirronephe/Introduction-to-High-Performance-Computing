# 全源最短路 大作业 实验报告 

颜子俊 2023010828

## 实现方法

按照两级分块的方式。对于所有 kernel，小块均设为 2×2。当 $n \le 1000$ 时，大块 32×32，线程块 16×16；当 $n > 1000$ 时，大块 64×64，线程块 32×32。

### kernel_phase1

所需数据仅局限在单个大块中，且需频繁更新同步，故将所有数据拷贝至共享内存。

### kernel_phase2_{row|col}

所需数据位于自身块和对角块中，并且无需更新同步（因对角块中元素已经预先更新完全），故将对角块数据拷贝至共享内存，将自身块内线程对应数据置于寄存器，自身块内其余数据直接访问全局内存。

### kernel_phase3

所需数据位于自身块和两个十字块中，且无需更新同步，故将十字块数据拷贝至共享内存，自身块内线程对应数据置于寄存器。

## 优化方法

- 提高单线程控制数据量（2×2）

- 非同步的频繁访问数据置于寄存器

- 循环展开，且参数设为常数

- 增大大块大小

- 循环停止条件预先计算

- 剪枝，不合法分支预先返回

## 实验结果

| n     | apsp（ms） | apsp_ref（ms） | 加速比（Speedup） |
| :---- | :----------------- | :----------------- | :---------------- |
| 1000  | 2.186056          | 14.194539          | 6.49×             |
| 2500  | 15.068974          | 377.803680         | 25.07×            |
| 5000  | 82.542000          | 2986.154694        | 36.18×            |
| 7500  | 272.057098         | 10049.149459       | 36.94×            |
| 10000 | 606.320049         | 22832.531725       | 37.65×            |
