# CUDA 并行策略 小作业 实验报告 

颜子俊 2023010828

## 测量结果（摘要）

| BlockDim.x | BlockDim.y | Naive Time (ms) | Shared Time (ms) |
|------------|-------------|------------------|-------------------|
| 32         | 1           | 9.57             | 10.13             |
| 32         | 4           | 7.64             | 5.53              |
| 32         | 8           | 7.70             | 5.49              |
| 64         | 4           | 7.69             | 5.32              |
| 64         | 8           | 7.81             | 5.41              |
| 128        | 4           | 7.77             | 5.30              |
| 128        | 8           | 7.95             | 5.60              |
| 256        | 4           | 7.92             | 5.35              |
| 512        | 2           | 7.87             | 5.23              |
| 1024       | 1           | 7.84             | 5.75              |

## 结果分析

### 对于该程序

- 设置 thread block size 为 512×2 且启用 shared memory 时效果最好。因为 SM 数量有限，调度需要开销，此时单个 SM 的线程被充分利用；并且共享内存在行方向上被更多地复用。
- 不是。Shared memory 只能在单 SM 内使用，当 block size 过小且内存复用少时，申请内存、传输数据的开销、`__syncthreads()` 同步的开销反而会造成负优化。
- Shared memory 在 32×1 时无效果，其余均有效果。
- 对于边界的 SM，可能分配的 shared memory 存在冗余，可以对边缘 block 和内部 block 分别处理。

### 对于任意程序

- 设置的 thread block size 总数应尽可能接近 SM 的最大并发线程数，并使线程数为 warp 大小（32）的整数倍，维度结构应当和具体任务相对应。
- 当存在大量内存复用时应当启用 shared memory。